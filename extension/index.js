(()=>{"use strict";var e={625:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveMatchController=void 0,t.ActiveMatchController=class{constructor(e,t){this.activeMatchService=t,e.listenFor("activeMatch:setWinner",((e,t)=>{try{null==e.gameIndex?this.activeMatchService.setLastWinner(e.winner):this.activeMatchService.setWinner(e.gameIndex,e.winner)}catch(e){t(e)}})),e.listenFor("activeMatch:removeLastWinner",((e,t)=>{try{this.activeMatchService.removeLastWinner()}catch(e){t(e)}})),e.listenFor("activeMatch:update",((e,t)=>{try{this.activeMatchService.setTeams(e.teamAId,e.teamBId,e.matchName)}catch(e){return t(e)}})),e.listenFor("activeMatch:setMaps",((e,t)=>{try{this.activeMatchService.setMaps(e)}catch(e){return t(e)}})),e.listenFor("activeMatch:setFirstPicker",((e,t)=>{try{this.activeMatchService.setFirstPicker(e)}catch(e){return t(e)}})),e.listenFor("activeMatch:addToGoalCount",((e,t)=>{try{this.activeMatchService.addToGoalCount(e)}catch(e){return t(e)}})),e.listenFor("activeMatch:removeFromGoalCount",((e,t)=>{try{this.activeMatchService.removeFromGoalCount(e)}catch(e){return t(e)}}))}}},953:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CasterController=void 0,t.CasterController=class{constructor(e,t){e.listenFor("casters:delete",((e,a)=>{try{t.delete(e)}catch(e){return a(e)}})),e.listenFor("casters:save",((e,a)=>{try{return a(null,t.save(e))}catch(e){return a(e)}}))}}},304:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NextMatchController=void 0,t.NextMatchController=class{constructor(e,t){e.listenFor("nextMatch:setTeamsAndMatchData",((e,a)=>{try{t.setTeamsAndMatchData(e.teamAId,e.teamBId,e.numberOfGames,e.matchName)}catch(e){return a(e)}})),e.listenFor("nextMatch:setMaps",((e,a)=>{try{t.setMaps(e)}catch(e){return a(e)}})),e.listenFor("nextMatch:begin",((e,a)=>{try{t.beginMatch()}catch(e){return a(e)}}))}}},954:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TeamController=void 0;const i=a(615);t.TeamController=class{constructor(e,t){const a=e.Replicant("teamStore");e.listenFor("teams:save",((e,s)=>{var c;if(e.players=null===(c=e.players)||void 0===c?void 0:c.map((e=>{var t;return Object.assign(Object.assign({},e),{id:null!==(t=e.id)&&void 0!==t?t:(0,i.generateId)()})})),e.id){const i=a.value.findIndex((t=>t.id===e.id));if(i<0)return s(new Error(`Could not find team with ID "${e.id}"`));a.value[i]=e,t.updateTeam(e)}else e.id=(0,i.generateId)(),a.value.push(e);s(null,e.id)})),e.listenFor("teams:reset",((e,i)=>{a.value=[{id:"aaa111",name:"Example team 1",players:[{id:"aaa1111",name:"Player One"},{id:"aaa1112",name:"Player Two"}]},{id:"bbb222",name:"Example team 2",players:[{id:"bbb2221",name:"Player Three"},{id:"bbb2222",name:"Player Four"}]}],t.setTeams("aaa111","bbb222"),i(null)})),e.listenFor("teams:delete",((e,t)=>{const i=a.value.length;return i<=1?t(new Error("Cannot delete the last team.")):(a.value=a.value.filter((t=>t.id!==e)),a.value.length===i?t(new Error(`Could not find team with ID '${e}'.`)):void t(null))}))}}},480:(e,t,a)=>{const i=a(954),s=a(625),c=a(906),r=a(218),n=a(22),o=a(304),h=a(614),l=a(953);e.exports=e=>{const t=new r.TeamStoreService(e),a=new c.ActiveMatchService(e,t),v=new n.NextMatchService(e,t,a),m=new h.CasterService(e);new i.TeamController(e,a),new s.ActiveMatchController(e,a),new o.NextMatchController(e,v),new l.CasterController(e,m)}},906:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveMatchService=void 0;const s=a(263),c=i(a(591)),r=i(a(359)),n=a(157);t.ActiveMatchService=class{constructor(e,t){this.activeMatch=e.Replicant("activeMatch"),this.teamStoreService=t}setLastWinner(e){const t=this.activeMatch.value.teamA.score+this.activeMatch.value.teamB.score;this.setWinner(t,e)}removeLastWinner(){const e=(0,r.default)(this.activeMatch.value.games,(e=>e.winner!==s.TeamRef.NONE));e>=0&&this.setWinner(e,s.TeamRef.NONE)}setWinner(e,t){if(e>=this.activeMatch.value.games.length||e<0)throw new Error(`Cannot set winner for game ${e+1} as it does not exist.`);const a=(0,c.default)(this.activeMatch.value),i=(0,c.default)(this.activeMatch.value.games[e]);t===s.TeamRef.NONE?(i.winner===s.TeamRef.ALPHA?a.teamA.score--:i.winner===s.TeamRef.BRAVO&&a.teamB.score--,a.games[e].winner=s.TeamRef.NONE):t===s.TeamRef.ALPHA?(a.teamA.score++,a.games[e].winner=t,i.winner===s.TeamRef.BRAVO&&a.teamB.score--):t===s.TeamRef.BRAVO&&(a.teamB.score++,a.games[e].winner=t,i.winner===s.TeamRef.ALPHA&&a.teamA.score--);const r=a.games.length/2;a.match.isCompleted=a.teamA.score>r||a.teamB.score>r,this.activeMatch.value=a}setTeams(e,t,a){const i=this.teamStoreService.getTeam(e),s=this.teamStoreService.getTeam(t);this.setTeam("A",i),this.setTeam("B",s),(0,n.isBlank)(a)||this.setActiveMatchName(a)}updateTeam(e){e.id===this.activeMatch.value.teamA.id&&this.setTeam("A",e),e.id===this.activeMatch.value.teamB.id&&this.setTeam("B",e)}setTeam(e,t){if("A"===e)this.activeMatch.value.teamA=Object.assign({score:this.activeMatch.value.teamA.score},(0,c.default)(t));else{if("B"!==e)throw new Error(`Unknown team '${e}'`);this.activeMatch.value.teamB=Object.assign({score:this.activeMatch.value.teamB.score},(0,c.default)(t))}}setMaps(e){if(e.length!==this.activeMatch.value.games.length)throw new Error(`Expected ${this.activeMatch.value.games.length} maps when updating, got ${e.length} instead.`);this.activeMatch.value.games=this.activeMatch.value.games.map(((t,a)=>Object.assign(Object.assign({},t),{map:e[a]})))}replaceMaps(e){this.activeMatch.value.games=e.map((e=>({map:e,winner:s.TeamRef.NONE,pickedBy:s.TeamRef.NONE,teamAGoalCount:0,teamBGoalCount:0}))),this.activeMatch.value.teamA.score=0,this.activeMatch.value.teamB.score=0,this.activeMatch.value.match.isCompleted=!1}setActiveMatchName(e){this.activeMatch.value.match.name=e}setFirstPicker(e){e===s.TeamRef.ALPHA?(this.activeMatch.value.games[0].pickedBy=s.TeamRef.ALPHA,this.activeMatch.value.games[1].pickedBy=s.TeamRef.BRAVO):e===s.TeamRef.BRAVO&&(this.activeMatch.value.games[0].pickedBy=s.TeamRef.BRAVO,this.activeMatch.value.games[1].pickedBy=s.TeamRef.ALPHA)}addToGoalCount(e){const t=this.activeMatch.value.games.findIndex((e=>e.winner===s.TeamRef.NONE));if(t>=0)if(e===s.TeamRef.ALPHA){const e=this.activeMatch.value.games[t].teamAGoalCount;this.activeMatch.value.games[t].teamAGoalCount=Math.min(e+1,5)}else if(e===s.TeamRef.BRAVO){const e=this.activeMatch.value.games[t].teamBGoalCount;this.activeMatch.value.games[t].teamBGoalCount=Math.min(e+1,5)}}removeFromGoalCount(e){const t=this.activeMatch.value.games.findIndex((e=>e.winner===s.TeamRef.NONE));if(t>=0)if(e===s.TeamRef.ALPHA){const e=this.activeMatch.value.games[t].teamAGoalCount;this.activeMatch.value.games[t].teamAGoalCount=Math.max(e-1,0)}else if(e===s.TeamRef.BRAVO){const e=this.activeMatch.value.games[t].teamBGoalCount;this.activeMatch.value.games[t].teamBGoalCount=Math.max(e-1,0)}}}},614:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CasterService=void 0;const i=a(615);t.CasterService=class{constructor(e){this.casters=e.Replicant("casters")}delete(e){const t=this.casters.value.length;if(this.casters.value=this.casters.value.filter((t=>t.id!==e)),this.casters.value.length===t)throw new Error(`Could not find caster with ID '${e}'`)}save(e){if(e.id){const t=this.casters.value.findIndex((t=>t.id===e.id));if(t<0)throw new Error(`Could not find caster with ID '${e.id}'`);return this.casters.value[t]=e,e}return e.id=(0,i.generateId)(),this.casters.value.push(e),e}}},22:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NextMatchService=void 0;const s=a(157),c=i(a(591));t.NextMatchService=class{constructor(e,t,a){this.nextMatch=e.Replicant("nextMatch"),this.teamStoreService=t,this.activeMatchService=a}setTeamsAndMatchData(e,t,a,i){const c=this.teamStoreService.getTeam(e),r=this.teamStoreService.getTeam(t);this.setTeam("A",c),this.setTeam("B",r),(0,s.isBlank)(i)||(this.nextMatch.value.match.name=i);const n=this.nextMatch.value.games.length;a!==n&&(this.nextMatch.value.games=a>n?[...this.nextMatch.value.games,...Array(a-n).fill({map:"Unknown"})]:this.nextMatch.value.games.slice(0,a))}setTeam(e,t){if("A"===e)this.nextMatch.value.teamA=(0,c.default)(t);else{if("B"!==e)throw new Error(`Unknown team '${e}'`);this.nextMatch.value.teamB=(0,c.default)(t)}}setMaps(e){if(e.length!==this.nextMatch.value.games.length)throw new Error(`Expected ${this.nextMatch.value.games.length} maps when updating, got ${e.length} instead.`);this.nextMatch.value.games=this.nextMatch.value.games.map(((t,a)=>Object.assign(Object.assign({},t),{map:e[a]})))}beginMatch(){this.activeMatchService.setTeams(this.nextMatch.value.teamA.id,this.nextMatch.value.teamB.id,this.nextMatch.value.match.name),this.activeMatchService.replaceMaps(this.nextMatch.value.games.map((e=>e.map))),this.activeMatchService.setActiveMatchName(this.nextMatch.value.match.name)}}},218:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TeamStoreService=void 0,t.TeamStoreService=class{constructor(e){this.teamStore=e.Replicant("teamStore")}getTeam(e){const t=this.teamStore.value.find((t=>t.id===e));if(!t)throw new Error(`Could not find team with ID '${e}'`);return t}}},615:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateId=void 0,t.generateId=function(){return String(Math.random().toString(36).substr(2,9))}},157:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBlank=t.addDots=void 0,t.addDots=function(e,t=48){return e&&e.length>t?e.substring(0,t-"...".length)+"...":e},t.isBlank=function(e){return null==e||""===e.trim()}},263:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.TeamRef=void 0,(a=t.TeamRef||(t.TeamRef={})).NONE="none",a.ALPHA="alpha",a.BRAVO="bravo"},591:e=>{e.exports=require("lodash/cloneDeep")},359:e=>{e.exports=require("lodash/findLastIndex")}},t={},a=function a(i){var s=t[i];if(void 0!==s)return s.exports;var c=t[i]={exports:{}};return e[i].call(c.exports,c,c.exports,a),c.exports}(480);module.exports=a})();